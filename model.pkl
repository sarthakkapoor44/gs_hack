import pandas as pd
from sklearn.ensemble import RandomForestRegressor
from sklearn.impute import SimpleImputer
import pickle

# Load the training data
training_data = pd.read_csv("training.csv")

# Feature engineering: Use cummulative_continous_volume and seconds_bucket as features
features = training_data[['cummulative_continous_volume', 'seconds_bucket']]
labels = training_data['close_volume']

# Impute missing values with the mean of the column
imputer = SimpleImputer(strategy='mean')
features_imputed = imputer.fit_transform(features)

# Train a Random Forest model
model = RandomForestRegressor()
model.fit(features_imputed, labels.fillna(0))  # Optionally, you can also impute labels if necessary

# Save the trained model locally using pickle
with open('close_volume_model.pkl', 'wb') as model_file:
    pickle.dump(model, model_file)

print("Model has been trained and saved as 'close_volume_model.pkl'.")
